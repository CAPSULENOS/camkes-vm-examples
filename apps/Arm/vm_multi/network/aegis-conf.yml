ingest:
  camera:
    vlan: 3000
  r2:
    vlan: 3004
  speaker:
    vlan: 3001
local_vms: 3
vnfs:
  internal_router:
    type: router
    routes:
      - to: 192.168.200.0/24
        via: 192.168.80.10
      - to: 192.168.201.0/24
        via: 192.168.80.10
      - to: 10.20.10.0/24
        via: 192.168.80.10
    interfaces:
      - dev: camera
        addr: 192.168.100.1/24
      - dev: speaker
        addr: 192.168.101.1/24
      - dev: r2
        addr: 192.168.80.1/24

  wgR1:
    type: ipsec 
    name: mytunnel
    
    ingest_ip: 192.168.30.1/24
    egress_ip: 192.168.80.10/24

    routes:
      - to: 192.168.81.0/24
        via: 192.168.80.1

    connections:
      wgR1:
        leftid:         "192.168.30.1"
        leftsubnet:     192.168.80.0/24
        
        right:          "192.168.30.2"
        rightsubnet:    192.168.81.0/24

        authby: secret      # load and initiate automatically
        
        ike: aes256-sha2_256-modp1024!
        esp: aes256-sha2_256!
        keyingtries: 0
        ikelifetime: 1h
        lifetime: 8h
        dpddelay: 30
        dpdtimeout: 120
        dpdaction: restart
        auto: start

      wgR1.1:
        also: wgR1
        rightsubnet: "192.168.100.0/24"

  firewall1:
    type: iptables
    setup: 
      - echo pass

  silent1:
    type: silent



data_paths:
  node_one_router:
    type: bidirectional
    path:
      - camera
      - silent1
      - internal_router

  node_two_router:
    type: bidirectional
    path:
      - speaker
      - firewall1
      - internal_router

  wireguard_exit:
    type: bidirectional
    path:
      - r2
      - wgR1
      - internal_router


